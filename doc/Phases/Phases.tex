\chapter{The phases of the tool} \label{chap:phases}
The tool consists of five main phases: parsing, control flow analysis, 
linearization, compilation and verification. A global overview of all these phases
and their inputs and outputs can be found in figure \ref{fig:phases_overview}.

\begin{figure}[H]
    \caption{An overview of the phases of the tool.}
    \centering
    \label{fig:phases_overview}
    \begin{tikzpicture}[node distance=0.85cm and 0.2cm, align=center]
        \tikzset{
            phase/.style      = { rectangle
                                , rounded corners 
                                , minimum width=2.5cm
                                , text centered
                                , draw=black
                                }
        , intermediate/.style = { rectangle
                                , minimum width=2.5cm
                                }
        , dots/.style         = { rectangle
                                , minimum width=0.5cm
                                }
        , arrow/.style        = { very thick
                                , shorten >= 0.2cm
                                , shorten <= 0.2cm
                                }
        }

        \node(input)             [intermediate]                       {Java source file};
        \node(parser)            [phase,below=of input] {Parsing};
            \node() [right=of parser] {module \haskellinline{Parsing.Phase}};
        \node(ast)               [intermediate,below=of parser]   {Abstract Syntax Tree};
        \node(analyzer)          [phase,below=of ast]    {Control Flow\\Analysis};
            \node() [right=of analyzer] {module \haskellinline{Analysis.Phase}};
        \node(cfg)               [intermediate,below=of analyzer]    {Control Flow Graph};
        \node(linearizer)        [phase,below=of cfg]              {Linearization};
            \node() [right=of linearizer] {module \haskellinline{Linearization.Phase}};
        \node(path_dots)         [dots,below=of linearizer]      {$\cdots$};
        \node(path_1)            [intermediate,left=of path_dots] {$\text{Program Path}_1$};
        \node(path_n)            [intermediate,right=of path_dots] {$\text{Program Path}_n$};
        \node(compiler_dots)     [dots,below=of path_dots]      {$\cdots$};
        \node(compiler_1)        [phase,left=of compiler_dots] {Compilation};
        \node(compiler_n)        [phase,right=of compiler_dots] {Compilation};
            \node() [right=of compiler_n] {module \haskellinline{Compilation.Phase}};
        \node(bytecode_dots)     [dots,below=of compiler_dots]      {$\cdots$};
        \node(bytecode_1)        [intermediate,left=of bytecode_dots] {$\text{Java Bytecode}_1$};
        \node(bytecode_n)        [intermediate,right=of bytecode_dots] {$\text{Java Bytecode}_n$};
        \node(verification_dots) [dots,below=of bytecode_dots]      {$\cdots$};
        \node(verification_1)    [phase,left=of verification_dots] {Verification};
        \node(verification_n)    [phase,right=of verification_dots] {Verification};
            \node() [right=of verification_n] {module \haskellinline{Verification.Phase}};
        \node(results)           [intermediate,below of=verification_dots] {Verification Results};

        \draw[arrow,->] (input) -- (parser);
        \draw[arrow,->] (parser) -- (ast);
        \draw[arrow,->] (ast) -- (analyzer);
        \draw[arrow,->] (analyzer) -- (cfg);
        \draw[arrow,->] (cfg) -- (linearizer);
        \draw[arrow,->] (linearizer) -- (path_1);
        \draw[arrow,->] (linearizer) -- (path_n);
        \draw[arrow,->] (path_1) -- (compiler_1);
        \draw[arrow,->] (path_n) -- (compiler_n);
        \draw[arrow,->] (compiler_1) -- (bytecode_1);
        \draw[arrow,->] (compiler_n) -- (bytecode_n);
        \draw[arrow,->] (bytecode_1) -- (verification_1);
        \draw[arrow,->] (bytecode_n) -- (verification_n);
        \draw[arrow,->] (verification_1) -- (results);
        \draw[arrow,->] (verification_n) -- (results);
    \end{tikzpicture}
\end{figure}

All phases are chained into one phase, the Complete phase. This phase is defined
in the \haskellinline{Complete} module and is the main API of the tool.

\input{Phases/Parsing.tex}

\input{Phases/Analysis.tex}

\input{Phases/Linearization.tex}

\input{Phases/Compilation.tex}

\input{Phases/Verification.tex}